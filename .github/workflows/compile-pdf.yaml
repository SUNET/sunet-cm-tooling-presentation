name: Compile PDF

on:
  pull_request:
  push:
  schedule:
    - cron: '0 0 * * *'


jobs:

  compile-pdf:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
      - uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
      - run: cargo install --locked --git https://github.com/mfontanini/presenterm
      - name: Install uv
        uses: astral-sh/setup-uv@v6
      - uses: actions/checkout@v5
        with:
          repository: SUNET/presenterm-sunet-theme
          path: presenterm-sunet-theme
      - run: mkdir -p /home/runner/.config/presenterm
      - run: cp -vr presenterm-sunet-theme/* /home/runner/.config/presenterm/
      - run: |
          cat >/tmp/config.yaml <<EOL
          export:
            dimensions:
              rows: 40
              columns: 150
          EOL
      - run: uv run --with weasyprint /home/runner/.cargo/bin/presenterm --export-pdf -c /tmp/config.yaml --theme sunet-export slides/init.md
      - uses: actions/upload-artifact@v4
        with:
          name: 'sunet-cm-tooling.pdf'
          path: 'slides/init.pdf'
